{% extends "colegioapp/base.html" %}
{% block title %}Logros | CEI GIN GABY{% endblock %}
{% block content %}
<main>
  <h2>Logros por Oferta y Periodo</h2>

  <div style="max-width:1100px;margin:0 auto 14px;display:flex;gap:10px;justify-content:space-between;flex-wrap:wrap;">
    <form method="get" style="display:flex;gap:10px;flex-wrap:wrap;flex:1;">
      <input name="q" value="{{ q }}" placeholder="Buscar por título, curso, asignatura, año"
             style="flex:1;min-width:240px;padding:10px 12px;border:1px solid #cfd8dc;border-radius:8px;">

      <select name="anio" style="padding:10px 12px;border:1px solid #cfd8dc;border-radius:8px;">
        <option value="">Año</option>
        {% for a in anios %}
          <option value="{{ a.id }}" {% if anio_selected == a.id|stringformat:'s' %}selected{% endif %}>{{ a.nombre }}</option>
        {% endfor %}
      </select>

      <select name="curso" style="padding:10px 12px;border:1px solid #cfd8dc;border-radius:8px;">
        <option value="">Curso</option>
        {% for c in cursos %}
          <option value="{{ c.id }}" {% if curso_selected == c.id|stringformat:'s' %}selected{% endif %}>{{ c.grado }} - {{ c.nombre }}</option>
        {% endfor %}
      </select>

      <select name="oferta" style="padding:10px 12px;border:1px solid #cfd8dc;border-radius:8px;min-width:220px;">
        <option value="">Oferta (Año-Curso-Asignatura)</option>
        {% for o in ofertas %}
          <option value="{{ o.id }}" {% if oferta_selected == o.id|stringformat:'s' %}selected{% endif %}>
            {{ o.anio.nombre }} | {{ o.curso.grado }}-{{ o.curso.nombre }} | {{ o.asignatura.nombre }}
          </option>
        {% endfor %}
      </select>

      <select name="periodo" style="padding:10px 12px;border:1px solid #cfd8dc;border-radius:8px;">
        <option value="">Periodo</option>
        {% for p in periodos %}
          <option value="{{ p.id }}" {% if periodo_selected == p.id|stringformat:'s' %}selected{% endif %}>
            {{ p.anio.nombre }} - {{ p.nombre }}
          </option>
        {% endfor %}
      </select>

      <button type="submit" style="padding:10px 16px;background:#00796B;color:#fff;border:none;border-radius:8px;">Filtrar</button>
      <a href="{% url 'academico:logros' %}" style="padding:10px 16px;background:#90a4ae;color:#fff;border-radius:8px;text-decoration:none;">Limpiar</a>
      <a href="{% url 'academico:logro_create' %}" style="padding:10px 16px;background:#004d40;color:#fff;border-radius:8px;text-decoration:none;">+ Nuevo logro</a>
      <a href="{% url 'academico:periodos' %}" style="padding:10px 16px;background:#004d40;color:#fff;border-radius:8px;text-decoration:none;">Periodos</a>
    </form>


  </div>

  <div style="max-width:1100px;margin:0 auto;">
    <div style="overflow-x:auto;background:#fff;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.06);">
      <table style="width:100%;border-collapse:collapse;">
        <thead style="background:#e0f2f1;">
          <tr>
            <th style="text-align:left;padding:12px;">Año</th>
            <th style="text-align:left;padding:12px;">Curso</th>
            <th style="text-align:left;padding:12px;">Asignatura</th>
            <th style="text-align:left;padding:12px;">Periodo</th>
            <th style="text-align:left;padding:12px;">Título</th>
            <th style="text-align:left;padding:12px;">Peso %</th>
            <th style="text-align:center;padding:12px;width:160px;">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% if page_obj.object_list %}
            {% for l in page_obj.object_list %}
            <tr style="border-top:1px solid #eceff1;">
              <td style="padding:10px 12px;">{{ l.oferta.anio.nombre }}</td>
              <td style="padding:10px 12px;">{{ l.oferta.curso.grado }} - {{ l.oferta.curso.nombre }}</td>
              <td style="padding:10px 12px;">{{ l.oferta.asignatura.nombre }}</td>
              <td style="padding:10px 12px;">{{ l.periodo.nombre }}</td>
              <td style="padding:10px 12px;">{{ l.titulo }}</td>
              <td style="padding:10px 12px;">{{ l.peso }}%</td>
              <td style="padding:10px 12px;text-align:center;">

                <!-- Botón actividades -->
                <a href="{% url 'academico:actividades' l.id %}"
                   style="text-decoration:none;margin-right:8px;">
                  Actividades
                </a> |

                <!-- Editar -->
                <a href="{% url 'academico:logro_update' l.id %}"
                   style="text-decoration:none;margin:0 8px;">
                  Editar
                </a> |

                <!-- Eliminar -->
                <a href="{% url 'academico:logro_delete' l.id %}"
                   style="text-decoration:none;color:#c62828;margin-left:8px;">
                  Eliminar
                </a>
              </td>
            </tr>
            {% endfor %}
          {% else %}
            <tr><td colspan="7" style="padding:16px;text-align:center;color:#607d8b;">No hay logros registrados.</td></tr>
          {% endif %}
        </tbody>
      </table>
    </div>

    {% if page_obj.paginator.num_pages > 1 %}
    <div style="display:flex;justify-content:center;gap:6px;margin:18px 0;">
      {% if page_obj.has_previous %}
        <a href="?page=1{% if querystring %}&{{ querystring }}{% endif %}" style="padding:8px 10px;border:1px solid #cfd8dc;border-radius:8px;text-decoration:none;">« Primero</a>
        <a href="?page={{ page_obj.previous_page_number }}{% if querystring %}&{{ querystring }}{% endif %}" style="padding:8px 10px;border:1px solid #cfd8dc;border-radius:8px;text-decoration:none;">‹ Anterior</a>
      {% endif %}
      <span style="padding:8px 10px;border:1px solid #cfd8dc;border-radius:8px;background:#f5f5f5;">Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{% if querystring %}&{{ querystring }}{% endif %}" style="padding:8px 10px;border:1px solid #cfd8dc;border-radius:8px;text-decoration:none;">Siguiente ›</a>
        <a href="?page={{ page_obj.paginator.num_pages }}{% if querystring %}&{{ querystring }}{% endif %}" style="padding:8px 10px;border:1px solid #cfd8dc;border-radius:8px;text-decoration:none;">Última »</a>
      {% endif %}
    </div>
    {% endif %}

    <div style="display:flex;justify-content:center;margin-top:10px;">
      <a href="{% url 'academico:hub' %}"
         style="padding:10px 16px;background:#9e9e9e;color:#fff;border-radius:8px;text-decoration:none;">
        Ir a gestión académica avanzada
      </a>
    </div>
  </div>
</main>
{% endblock %}