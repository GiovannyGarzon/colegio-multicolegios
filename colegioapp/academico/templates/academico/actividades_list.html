{% extends "colegioapp/base.html" %}
{% block title %}Actividades del Logro | {{ request.school.name }}{% endblock %}

{% block content %}
<main style="max-width:1000px;margin:0 auto;padding:20px;">

  <!-- TÍTULO -->
  <h2 style="margin-bottom:8px;color:var(--primary-color);">
    Actividades del logro
  </h2>

  <!-- CONTEXTO ASIGNATURA / CURSO / PERIODO -->
  <p style="margin-top:0;color:#475569;font-size:0.95rem;">
    <strong>Asignatura:</strong> {{ logro.oferta.asignatura.nombre }} &nbsp;•&nbsp;
    <strong>Curso:</strong> {{ logro.oferta.curso.grado }} - {{ logro.oferta.curso.nombre }} &nbsp;•&nbsp;
    <strong>Periodo:</strong> {{ logro.periodo.nombre }}
  </p>

  <!-- TARJETA DEL LOGRO -->
  <div style="
      background:#e3f2fd;
      padding:10px 14px;
      border-radius:10px;
      margin:10px 0 18px;
      color:#0d47a1;
  ">
    <strong>Logro:</strong> {{ logro.titulo }}<br>
    {% if logro.descripcion %}
      <small style="color:#1e3a8a;">{{ logro.descripcion }}</small>
    {% endif %}
  </div>

  <!-- BOTONES SUPERIORES -->
  <div style="margin: 10px 0 18px; display:flex; gap:10px; flex-wrap:wrap;">
    <a href="{% url 'academico:actividad_create' logro.id %}"
       style="
         background:var(--primary-color);
         color:white;
         padding:8px 14px;
         border-radius:8px;
         text-decoration:none;
         font-size:0.95rem;
         font-weight:600;
       ">
      + Nueva actividad
    </a>

    <a href="{% url 'academico:notas_selector' %}"
       style="
         background:#64748b;
         color:white;
         padding:8px 14px;
         border-radius:8px;
         text-decoration:none;
         font-size:0.95rem;
       ">
      ← Volver a selección de notas
    </a>
  </div>

  {% if actividades %}
    <div style="
        margin-top:6px;
        background:#ffffff;
        border-radius:12px;
        box-shadow:0 4px 12px rgba(0,0,0,0.06);
        overflow:hidden;
    ">
      <table style="width:100%;border-collapse:collapse;">
        <thead style="background:#e0f2f1;">
          <tr>
            <th style="padding:12px;text-align:left;">Título</th>
            <th style="padding:12px;text-align:center;width:110px;">Peso (%)</th>
            <th style="padding:12px;text-align:center;width:140px;">Fecha</th>
            <th style="padding:12px;text-align:center;width:220px;">Acciones</th>
          </tr>
        </thead>

        <tbody>
        {% for a in actividades %}
          <tr style="border-top:1px solid #e2e8f0;">
            <!-- TÍTULO -->
            <td style="padding:10px 12px;">
              {{ a.titulo }}
            </td>

            <!-- PESO -->
            <td style="padding:10px 12px;text-align:center;">
              {{ a.peso|default:"—" }}
            </td>

            <!-- FECHA -->
            <td style="padding:10px 12px;text-align:center;">
              {{ a.fecha|default:"—" }}
            </td>

            <!-- ACCIONES -->
            <td style="padding:10px 12px;text-align:center;">

              {% if a.total_notas %}
                <div style="font-size:11px;color:#166534;margin-bottom:4px;">
                  ✔ Ya tiene {{ a.total_notas }} nota{{ a.total_notas|pluralize:",s" }}
                </div>
              {% else %}
                <div style="font-size:11px;color:#b45309;margin-bottom:4px;">
                  ✎ Aún sin calificaciones
                </div>
              {% endif %}

              <a href="{% url 'academico:actividad_notas' a.id %}"
                 style="
                   background:#0288d1;
                   color:white;
                   padding:6px 12px;
                   border-radius:6px;
                   text-decoration:none;
                   font-size:0.9rem;
                 ">
                Calificar actividad
              </a>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div style="
        margin-top:12px;
        background:#ffffff;
        border-radius:12px;
        padding:16px 18px;
        box-shadow:0 2px 8px rgba(0,0,0,0.04);
        color:#64748b;
        text-align:center;
    ">
      No hay actividades registradas para este logro.
      <br>
      <a href="{% url 'academico:actividad_create' logro.id %}"
         style="
           display:inline-block;
           margin-top:10px;
           padding:8px 14px;
           background:var(--primary-color);
           color:#fff;
           border-radius:8px;
           text-decoration:none;
           font-size:0.9rem;
         ">
        + Crear primera actividad
      </a>
    </div>
  {% endif %}

</main>
{% endblock %}