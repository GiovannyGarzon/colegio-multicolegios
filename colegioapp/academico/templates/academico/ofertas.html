{% extends "colegioapp/base.html" %}
{% block title %}
  Oferta Académica | {{ request.school.nombre|default:"Institución Educativa" }}
{% endblock %}

{% block content %}
<main style="padding:16px 10px;">
  <h2 style="
        text-align:center;
        margin-bottom:18px;
        color:var(--color-primary, #2563eb);
      ">
    Oferta Académica
  </h2>

  <div style="
        max-width:1100px;
        margin:0 auto 14px;
        display:flex;
        gap:10px;
        justify-content:space-between;
        flex-wrap:wrap;
        align-items:flex-start;
      ">

    <form method="get"
          style="display:flex;gap:10px;flex-wrap:wrap;flex:1;align-items:center;">
      <input name="q"
             value="{{ q }}"
             placeholder="Buscar por curso, asignatura, docente o año"
             class="fld-input"
             style="flex:1;min-width:230px;">

      <select name="anio" class="fld-input" style="min-width:120px;">
        <option value="">Año</option>
        {% for a in anios %}
          <option value="{{ a.id }}"
                  {% if anio_selected == a.id|stringformat:'s' %}selected{% endif %}>
            {{ a.nombre }}
          </option>
        {% endfor %}
      </select>

      <select name="curso" class="fld-input" style="min-width:150px;">
        <option value="">Curso</option>
        {% for c in cursos %}
          <option value="{{ c.id }}"
                  {% if curso_selected == c.id|stringformat:'s' %}selected{% endif %}>
            {{ c.grado }} - {{ c.nombre }}
          </option>
        {% endfor %}
      </select>

      <select name="asignatura" class="fld-input" style="min-width:150px;">
        <option value="">Asignatura</option>
        {% for a in asignaturas %}
          <option value="{{ a.id }}"
                  {% if asig_selected == a.id|stringformat:'s' %}selected{% endif %}>
            {{ a.nombre }}
          </option>
        {% endfor %}
      </select>

      <select name="docente" class="fld-input" style="min-width:150px;">
        <option value="">Docente</option>
        {% for d in docentes %}
          <option value="{{ d.id }}"
                  {% if docente_selected == d.id|stringformat:'s' %}selected{% endif %}>
            {{ d.apellidos }} {{ d.nombres }}
          </option>
        {% endfor %}
      </select>

      <button type="submit" class="btn-acad">
        Filtrar
      </button>
      <a href="{% url 'academico:ofertas' %}" class="btn-acad-muted">
        Limpiar
      </a>
    </form>

    <div style="display:flex;gap:8px;align-items:center;margin-top:8px;">
      <a href="{% url 'academico:oferta_bulk_create' %}" class="btn-acad-sec">
        + Asignación masiva
      </a>
      <a href="{% url 'academico:oferta_create' %}" class="btn-acad">
        + Nueva oferta
      </a>
    </div>
  </div>

  <div style="max-width:1100px;margin:0 auto;">
    <div style="
          overflow-x:auto;
          background:#ffffff;
          border-radius:12px;
          box-shadow:0 4px 12px rgba(15,23,42,0.08);
          border:1px solid var(--color-muted-border, #e5e7eb);
        ">
      <table style="width:100%;border-collapse:collapse;font-size:0.92rem;">
        <thead style="background:var(--color-table-head, #f1f5f9);">
          <tr>
            <th class="tbl-th">Año</th>
            <th class="tbl-th">Curso</th>
            <th class="tbl-th">Asignatura</th>
            <th class="tbl-th">Docente</th>
            <th class="tbl-th" style="text-align:center;">Horas/sem.</th>
            <th class="tbl-th" style="text-align:center;width:190px;">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% if page_obj.object_list %}
            {% for o in page_obj.object_list %}
            <tr class="tbl-tr">
              <td class="tbl-td">{{ o.anio.nombre }}</td>
              <td class="tbl-td">{{ o.curso.grado }} - {{ o.curso.nombre }}</td>
              <td class="tbl-td">{{ o.asignatura.nombre }}</td>
              <td class="tbl-td">
                {% if o.docente %}
                  {{ o.docente.apellidos }} {{ o.docente.nombres }}
                {% else %}
                  <em>—</em>
                {% endif %}
              </td>
              <td class="tbl-td" style="text-align:center;">{{ o.intensidad_horaria }}</td>
              <td class="tbl-td" style="text-align:center;white-space:nowrap;">
                <a href="{% url 'academico:oferta_update' o.id %}"
                   class="lnk-table">
                  Editar
                </a>
                <span style="color:#cbd5f5;">|</span>
                <a href="{% url 'academico:oferta_delete' o.id %}"
                   class="lnk-table lnk-danger">
                  Eliminar
                </a>
              </td>
            </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="6"
                  style="padding:16px;text-align:center;color:#6b7280;">
                No hay ofertas registradas.
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>

    {% if page_obj.paginator.num_pages > 1 %}
    <div style="display:flex;justify-content:center;gap:6px;margin:18px 0;flex-wrap:wrap;">
      {% if page_obj.has_previous %}
        <a href="?page=1{% if querystring %}&{{ querystring }}{% endif %}"
           class="pager-link">
          « Primero
        </a>
        <a href="?page={{ page_obj.previous_page_number }}{% if querystring %}&{{ querystring }}{% endif %}"
           class="pager-link">
          ‹ Anterior
        </a>
      {% endif %}

      <span class="pager-page">
        Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
      </span>

      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{% if querystring %}&{{ querystring }}{% endif %}"
           class="pager-link">
          Siguiente ›
        </a>
        <a href="?page={{ page_obj.paginator.num_pages }}{% if querystring %}&{{ querystring }}{% endif %}"
           class="pager-link">
          Última »
        </a>
      {% endif %}
    </div>
    {% endif %}

    <div style="display:flex;justify-content:center;margin-top:10px;">
      <a href="{% url 'academico:hub' %}" class="btn-acad-sec">
        Ir a gestión académica avanzada
      </a>
    </div>
  </div>
</main>

<style>
  .fld-input{
    padding:9px 11px;
    border-radius:8px;
    border:1px solid #cbd5e1;
    font-size:0.9rem;
    background:#ffffff;
    min-height:38px;
  }
  .fld-input:focus{
    outline:none;
    border-color:var(--color-primary, #2563eb);
    box-shadow:0 0 0 1px rgba(37,99,235,0.15);
  }

  .tbl-th{
    text-align:left;
    padding:10px 12px;
    font-weight:600;
    font-size:0.86rem;
    color:#0f172a;
    border-bottom:1px solid #e2e8f0;
  }
  .tbl-tr:nth-child(even){
    background:#f9fafb;
  }
  .tbl-td{
    padding:10px 12px;
    border-top:1px solid #e5e7eb;
    color:#111827;
  }

  .lnk-table{
    text-decoration:none;
    font-size:0.86rem;
    color:var(--color-primary, #2563eb);
  }
  .lnk-table:hover{
    text-decoration:underline;
  }
  .lnk-danger{
    color:#b91c1c;
  }

  .pager-link{
    padding:7px 10px;
    border:1px solid #cbd5e1;
    border-radius:999px;
    text-decoration:none;
    font-size:0.85rem;
    color:#111827;
    background:#ffffff;
  }
  .pager-link:hover{
    background:#e5e7eb;
  }
  .pager-page{
    padding:7px 10px;
    border-radius:999px;
    border:1px solid #cbd5e1;
    background:#f3f4f6;
    font-size:0.85rem;
  }

  .btn-acad{
    text-decoration:none;
    background:var(--color-primary, #2563eb);
    color:#ffffff;
    padding:8px 14px;
    border-radius:999px;
    font-size:0.88rem;
    border:1px solid transparent;
    cursor:pointer;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:6px;
    transition:background 0.15s ease, box-shadow 0.15s ease, transform 0.1s ease;
  }
  .btn-acad:hover{
    background:var(--color-primary-dark, #1d4ed8);
    box-shadow:0 3px 8px rgba(15,23,42,0.18);
    transform:translateY(-1px);
  }

  .btn-acad-muted{
    text-decoration:none;
    background:var(--color-muted, #6b7280);
    color:#ffffff;
    padding:8px 14px;
    border-radius:999px;
    font-size:0.88rem;
    border:1px solid transparent;
    cursor:pointer;
    display:inline-flex;
    align-items:center;
    justify-content:center;
  }
  .btn-acad-muted:hover{
    background:var(--color-muted-dark, #4b5563);
  }

  .btn-acad-sec{
    text-decoration:none;
    background:var(--color-muted-soft, #9ca3af);
    color:#ffffff;
    padding:8px 16px;
    border-radius:999px;
    font-size:0.88rem;
    border:1px solid transparent;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    transition:background 0.15s ease, box-shadow 0.15s ease, transform 0.1s ease;
  }
  .btn-acad-sec:hover{
    background:var(--color-muted, #6b7280);
    box-shadow:0 3px 8px rgba(15,23,42,0.18);
    transform:translateY(-1px);
  }
</style>
{% endblock %}