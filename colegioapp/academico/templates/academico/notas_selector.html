{% extends "colegioapp/base.html" %}
{% block title %}Captura de Notas • Selector | {{ request.school.name }}{% endblock %}

{% block content %}
<main style="max-width:960px;margin:0 auto;padding:20px 10px;">

  <h2 style="color:var(--primary-color);margin-bottom:6px;">
    Captura de Notas — Selección
  </h2>

  {% if docente and not user.is_staff and not user.is_superuser %}
    <p style="margin-top:0;color:#607d8b;font-size:0.95rem;">
      Solo se muestran los cursos y asignaturas que tienes asignados como docente.
    </p>
  {% else %}
    <p style="margin-top:0;color:#4b5563;font-size:0.95rem;">
      Elige el año lectivo, el curso, la oferta (asignatura) y el período para capturar las notas.
    </p>
  {% endif %}

  {# ===================================================== #}
  {#  FORMULARIO 1 — FILTROS: AÑO / CURSO / OFERTA / PERIODO #}
  {# ===================================================== #}
  <form method="get"
        action="{% url 'academico:notas_selector' %}"
        style="
          margin-top:12px;
          background:#ffffff;
          padding:22px 20px;
          border-radius:14px;
          border:1px solid #e5e7eb;
          box-shadow:0 4px 10px rgba(0,0,0,0.06);
          display:grid;
          grid-template-columns:1fr 1fr;
          gap:16px;
        ">

    <!-- Año lectivo -->
    <div>
      <label class="form-label">Año lectivo</label>
      <select name="anio" required onchange="this.form.submit()"
              class="acad-select">
        <option value="">Seleccione…</option>
        {% for a in anios %}
          <option value="{{ a.id }}" {% if anio_selected == a.id|stringformat:'s' %}selected{% endif %}>
            {{ a.nombre }} {% if a.activo %}(activo){% endif %}
          </option>
        {% endfor %}
      </select>
    </div>

    <!-- Curso -->
    <div>
      <label class="form-label">Curso</label>
      <select name="curso" required
              {% if not anio_selected %}disabled{% endif %}
              onchange="this.form.submit()"
              class="acad-select">
        <option value="">Seleccione…</option>
        {% for c in cursos %}
          <option value="{{ c.id }}" {% if curso_selected == c.id|stringformat:'s' %}selected{% endif %}>
            {{ c.grado }} - {{ c.nombre }}
          </option>
        {% endfor %}
      </select>
    </div>

    <!-- Oferta -->
    <div>
      <label class="form-label">Oferta (Asignatura)</label>
      <select name="oferta" required
              {% if not anio_selected or not curso_selected %}disabled{% endif %}
              onchange="this.form.submit()"
              class="acad-select">
        <option value="">Seleccione…</option>
        {% for o in ofertas %}
          <option value="{{ o.id }}" {% if oferta_selected == o.id|stringformat:'s' %}selected{% endif %}>
            {{ o.anio.nombre }} | {{ o.curso.grado }}-{{ o.curso.nombre }} | {{ o.asignatura.nombre }}
          </option>
        {% endfor %}
      </select>
    </div>

    <!-- Periodo -->
    <div>
      <label class="form-label">Periodo</label>
      <select name="periodo" required
              {% if not anio_selected %}disabled{% endif %}
              onchange="this.form.submit()"
              class="acad-select">
        <option value="">Seleccione…</option>
        {% for p in periodos %}
          <option value="{{ p.id }}" {% if periodo_selected == p.id|stringformat:'s' %}selected{% endif %}>
            {{ p.anio.nombre }} - {{ p.nombre }}
          </option>
        {% endfor %}
      </select>
    </div>

    <!-- Botón volver -->
    <div style="grid-column:1/-1;display:flex;justify-content:flex-end;margin-top:4px;">
      <a href="{% url 'academico:hub' %}" class="btn-acad-muted">
        Ir a gestión académica avanzada
      </a>
    </div>
  </form>

  {# ===================================================== #}
  {#  FORMULARIO 2 — ACCIONES (LOGROS / SABER SER)         #}
  {#  SOLO SI YA HAY SELECCIÓN COMPLETA                    #}
  {# ===================================================== #}

  {% if anio_selected and curso_selected and oferta_selected and periodo_selected %}
    <div style="max-width:900px;margin:16px auto 0;display:flex;justify-content:flex-end;gap:10px;flex-wrap:wrap;">

      <!-- Captura de notas por Logros -->
      <form method="get" action="{% url 'academico:notas_capturar' %}">
        <input type="hidden" name="anio" value="{{ anio_selected }}">
        <input type="hidden" name="curso" value="{{ curso_selected }}">
        <input type="hidden" name="oferta" value="{{ oferta_selected }}">
        <input type="hidden" name="periodo" value="{{ periodo_selected }}">
        <button type="submit" class="btn-acad">
          Capturar notas de Logros
        </button>
      </form>

      <!-- Captura Saber Ser -->
      <a href="{% url 'academico:saber_ser_capturar' oferta_selected periodo_selected %}"
         class="btn-acad-alt">
        Capturar Saber Ser
      </a>

    </div>
  {% endif %}

</main>

<style>
  .form-label{
    display:block;
    font-weight:600;
    margin-bottom:4px;
    color:#111827;
    font-size:0.9rem;
  }
  .acad-select{
    width:100%;
    padding:9px 10px;
    border-radius:8px;
    border:1px solid #cfd8dc;
    font-size:0.9rem;
    background:#ffffff;
  }

  .btn-acad{
    background:var(--primary-color);
    color:#fff;
    padding:9px 16px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-size:0.9rem;
    text-decoration:none;
    display:inline-flex;
    align-items:center;
    gap:6px;
    transition:0.15s ease;
  }
  .btn-acad:hover{
    filter:brightness(1.07);
  }

  .btn-acad-alt{
    background:#0f766e; /* tonalidad alternativa pero igual temática */
    color:#fff;
    padding:9px 16px;
    border-radius:10px;
    text-decoration:none;
    font-size:0.9rem;
    display:inline-flex;
    align-items:center;
    gap:6px;
    transition:0.15s ease;
  }
  .btn-acad-alt:hover{
    filter:brightness(1.07);
  }

  .btn-acad-muted{
    background:#9ca3af;
    color:#fff;
    padding:9px 16px;
    border-radius:10px;
    text-decoration:none;
    font-size:0.9rem;
    display:inline-flex;
    align-items:center;
    transition:0.15s ease;
  }
  .btn-acad-muted:hover{
    background:#6b7280;
  }
</style>
{% endblock %}