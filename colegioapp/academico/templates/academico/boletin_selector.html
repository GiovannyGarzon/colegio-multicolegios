{# academico/templates/academico/boletin_selector.html #}
{% extends "colegioapp/base.html" %}
{% block title %}Boletines | CEI GIN GABY{% endblock %}

{% block content %}
<main style="max-width:900px;margin:0 auto;">
  <h2 style="color:#00796B;">Boletines académicos</h2>
  <p>Selecciona <strong>año</strong>, <strong>curso</strong> y <strong>periodo</strong>. Luego verás el listado de estudiantes con su botón para generar PDF individual.</p>

  <form method="get" style="background:#fff;padding:16px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.08); display:grid; grid-template-columns: 1fr 1fr 1fr auto; gap:10px; align-items:end;">
    <div>
      <label style="font-weight:600;">Año lectivo</label>
      <select name="anio" class="form-select" required onchange="this.form.submit()">
        <option value="">— Seleccionar —</option>
        {% for a in anios %}
          <option value="{{ a.id }}" {% if a.id|stringformat:'s' == anio_selected %}selected{% endif %}>
            {{ a.nombre }}{% if a.activo %} • Activo{% endif %}
          </option>
        {% endfor %}
      </select>
    </div>

    <div>
      <label style="font-weight:600;">Curso</label>
      <select name="curso" class="form-select" required {% if not anio_selected %}disabled{% endif %}>
        <option value="">— Seleccionar —</option>
        {% for c in cursos %}
          <option value="{{ c.id }}" {% if c.id|stringformat:'s' == curso_selected %}selected{% endif %}>
            {{ c.grado }} - {{ c.nombre }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div>
      <label style="font-weight:600;">Periodo</label>
      <select name="periodo" class="form-select" required {% if not anio_selected %}disabled{% endif %}>
        <option value="">— Seleccionar —</option>
        {% for p in periodos %}
          <option value="{{ p.id }}" {% if p.id|stringformat:'s' == periodo_selected %}selected{% endif %}>
            {{ p.nombre }} ({{ p.anio.nombre }})
          </option>
        {% endfor %}
      </select>
    </div>

    <div>
      <button type="submit" class="btn" style="width:100%;">Filtrar</button>
    </div>
  </form>

  {% if estudiantes and anio_selected and periodo_selected %}
    <div style="margin-top:18px;">
      <h3 style="margin:0 0 10px 0;">Estudiantes del curso ({{ estudiantes|length }})</h3>
      <div style="overflow-x:auto; background:#fff; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.06);">
        <table style="width:100%; border-collapse:collapse;">
          <thead style="background:#e0f2f1;">
            <tr>
              <th style="text-align:left; padding:10px;">Identificación</th>
              <th style="text-align:left; padding:10px;">Apellidos</th>
              <th style="text-align:left; padding:10px;">Nombres</th>
              <th style="text-align:center; padding:10px;">Boletín</th>
            </tr>
          </thead>
          <tbody>
            {% for e in estudiantes %}
              <tr style="border-top:1px solid #eceff1;">
                <td style="padding:10px;">{{ e.identificacion }}</td>
                <td style="padding:10px;">{{ e.apellidos }}</td>
                <td style="padding:10px;">{{ e.nombres }}</td>
                <td style="padding:8px; text-align:center;">
                  <a
                    href="{% url 'academico:boletin_estudiante' %}?anio={{ anio_selected }}&curso={{ curso_selected }}&periodo={{ periodo_selected }}&estudiante={{ e.id }}"
                    class="btn"
                    style="text-decoration:none; padding:8px 12px; border-radius:8px; display:inline-block;"
                    title="Generar PDF del boletín"
                  >Generar PDF</a>
                </td>
              </tr>
            {% empty %}
              <tr><td colspan="4" style="padding:12px; text-align:center; color:#607d8b;">Sin estudiantes en este curso.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% elif curso_selected %}
    <p style="margin-top:12px; color:#607d8b;">Selecciona también el <strong>Periodo</strong> para habilitar los botones de PDF.</p>
  {% endif %}

  <div style="display:flex;justify-content:center;margin-top:18px;gap:10px;">
    <a href="{% url 'academico:hub' %}"
         style="padding:10px 16px;background:#9e9e9e;color:#fff;border-radius:8px;text-decoration:none;">
        Ir a gestión académica avanzada
      </a>
  </div>
</main>

<style>
  .btn{ background:#00796B; color:white; border:none; cursor:pointer; }
  .btn-sec{ text-decoration:none; background:#9e9e9e; color:#fff; padding:10px 16px; border-radius:10px; }
  .form-select{ width:100%; padding:8px 10px; border:1px solid #cfd8dc; border-radius:8px; }
</style>
{% endblock %}