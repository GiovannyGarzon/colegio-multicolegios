{% extends "sitio/base_publico.html" %}
{% load static %}

{% block title %}
  {% if request.school %}Noticias | {{ request.school.name }}{% else %}Noticias{% endif %}
{% endblock %}

{% block extra_css %}
<style>
  .news-hero{background:linear-gradient(135deg,#e8f5e9,#e0f2f1);padding:36px 16px}
  .news-wrap{max-width:1100px;margin:0 auto}
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#004d40;color:#fff;font-size:.85rem;margin-right:6px}
  .card{display:grid;grid-template-columns:1.2fr 1fr;gap:22px;background:#fff;border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.08);overflow:hidden}
  .card img{width:100%;height:100%;object-fit:cover}
  .card-body{padding:18px 18px 20px}
  .meta{color:#607d8b;font-size:.9rem;margin-bottom:8px}
  .cta-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  .btn{display:inline-block;padding:10px 14px;border-radius:10px;text-decoration:none;font-weight:700}
  .btn-primary{background:#00796B;color:#fff}
  .btn-ghost{background:#e0f2f1;color:#00695c}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-top:22px}
  .mini{background:#fff;border-radius:14px;overflow:hidden;box-shadow:0 6px 16px rgba(0,0,0,.06)}
  .mini img{width:100%;height:160px;object-fit:cover}
  .mini .p{padding:12px 14px}
  .tag{font-size:.78rem;background:#f1f8e9;color:#33691e;border-radius:999px;padding:4px 8px}
  .muted{color:#455a64}
  @media (max-width:980px){.card{grid-template-columns:1fr}.grid{grid-template-columns:1fr 1fr}}
  @media (max-width:640px){.grid{grid-template-columns:1fr}}
</style>
{% endblock %}

{% block content %}
<section class="news-hero">
  <div class="news-wrap">
    <h2 style="margin:0 0 6px;color:#00796B;">Noticias y Novedades</h2>
    <p style="margin:0;color:#546e7a">
      Comunicados, admisiones y vida escolar del {% if request.school %}{{ request.school.name }}{% else %}colegio{% endif %}.
    </p>
  </div>
</section>

<section style="padding:18px 16px">
  <div class="news-wrap">

    {% if posts %}
      {% with featured=posts.0 %}

      <!-- NOTICIA DESTACADA -->
      <article class="card" aria-labelledby="tit-featured">
        <figure>
          {% if featured.image %}
            <img src="{{ featured.image.url }}" alt="{{ featured.title }}">
          {% else %}
            <img src="{% static 'sitio/img/hero_fallback.jpg' %}" alt="{{ featured.title }}">
          {% endif %}
        </figure>

        <div class="card-body">
          <div class="meta">
            Publicado: {{ featured.published_at|date:"d M Y" }}
          </div>

          <h3 id="tit-featured" style="margin:0 0 8px; font-size:1.6rem; color:#004d40;">
            {{ featured.title }}
          </h3>

          <!-- Chips “simples” (si no tienes tags en el modelo, esto es fijo) -->
          <div style="margin:8px 0 12px;">
            <span class="pill">Noticias</span>
            <span class="pill" style="background:#00695c;">Comunicado</span>
          </div>

          {% if featured.summary %}
            <p style="line-height:1.6; margin:0 0 10px;">
              {{ featured.summary|linebreaksbr }}
            </p>
          {% endif %}

          {% if featured.content %}
            <div class="muted" style="line-height:1.6; margin:0 0 10px;">
              {{ featured.content|linebreaksbr }}
            </div>
          {% endif %}

          <div class="cta-row">
            <a class="btn btn-primary" href="{% url 'sitio:admisiones' %}">Más información de Admisiones</a>

            {% if config and config.whatsapp %}
              <a class="btn btn-ghost"
                 href="https://wa.me/{{ config.whatsapp|cut:'+'|cut:' ' }}"
                 target="_blank" rel="noopener">
                Escríbenos por WhatsApp
              </a>
            {% endif %}

            <a class="btn btn-ghost" href="{% url 'sitio:contacto' %}">Contáctanos</a>
          </div>
        </div>
      </article>

      {% endwith %}

      <!-- OTRAS NOTICIAS -->
      {% if posts|length > 1 %}
        <div class="grid">
          {% for post in posts|slice:"1:" %}
            <article class="mini">
              {% if post.image %}
                <img src="{{ post.image.url }}" alt="{{ post.title }}">
              {% else %}
                <img src="{% static 'sitio/img/hero_fallback.jpg' %}" alt="{{ post.title }}">
              {% endif %}
              <div class="p">
                <div class="meta" style="margin:0 0 6px;">
                  {{ post.published_at|date:"d M Y" }}
                </div>
                <h4 style="margin:0 0 8px;color:#004d40;">{{ post.title }}</h4>

                {% if post.summary %}
                  <p class="muted" style="margin:0 0 10px;line-height:1.5;">
                    {{ post.summary|truncatechars:140 }}
                  </p>
                {% endif %}

                <span class="tag">Publicado</span>
              </div>
            </article>
          {% endfor %}
        </div>
      {% endif %}

    {% else %}
      <div style="background:#fff;border-radius:16px;padding:18px;box-shadow:0 8px 24px rgba(0,0,0,.06);">
        <h3 style="margin:0 0 6px;color:#004d40;">Aún no hay noticias publicadas</h3>
        <p style="margin:0;color:#546e7a;">Cuando publiques noticias desde el admin, aparecerán aquí automáticamente.</p>
      </div>
    {% endif %}

  </div>
</section>
{% endblock %}