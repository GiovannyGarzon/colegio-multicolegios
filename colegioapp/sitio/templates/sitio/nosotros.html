{% extends "sitio/base_publico.html" %}
{% load static %}

{% block title %}
  {% if page and page.title %}{{ page.title }} | {% endif %}
  {% if request.school %}{{ request.school.name }}{% else %}Nosotros{% endif %}
{% endblock %}

{% block extra_css %}
<style>
  /* ===== HERO ===== */
  .hero { padding: 32px 16px; background: linear-gradient(135deg,#e8f5e9,#e0f2f1); }
  .wrap { max-width: 1100px; margin: 0 auto; }
  .h2 { color:#00796B; margin:0 0 6px; font-weight:800; }
  .lead { color:#546e7a; margin:0; }

  /* ===== SLIDER ===== */
  .slider{
    position:relative;
    border-radius:18px;
    overflow:hidden;
    box-shadow:0 10px 30px rgba(0,0,0,.10);
    margin-top: 20px;
    width:100%;
    background:#e0f2f1;
  }
  .slides{ display:flex; transition: transform .8s ease-in-out; }
  .slide{ flex:0 0 100%; }
  .slides img{
    width:100%;
    height: 520px;
    object-fit: cover;
    display:block;
  }
  .dots{
    position:absolute;
    bottom:12px; left:0; right:0;
    display:flex;
    justify-content:center;
    gap:8px;
    z-index: 5;
  }
  .dot{
    width:10px; height:10px;
    border-radius:999px;
    background:#ffffffb3;
    border:2px solid #fff;
    opacity:.7;
    cursor:pointer;
  }
  .dot.active{ background:#00796B; opacity:1; }

  /* ===== BANNER DEBAJO DEL SLIDER (banner de "nostros") ===== */
  .below-banner{
    margin-top: 18px;
    border-radius: 16px;
    overflow:hidden;
    background:#fff;
    box-shadow:0 8px 24px rgba(0,0,0,.06);
  }
  .below-banner img{
    width:100%;
    height: 280px;
    object-fit: cover;
    display:block;
  }

  /* ===== SECCIONES ===== */
  .section { padding: 26px 16px; }
  .card {
    background:#fff;
    border-radius:16px;
    box-shadow:0 8px 24px rgba(0,0,0,.06);
    padding:22px;
  }
  .twocol { display:grid; grid-template-columns:1fr 1fr; gap:18px; }

  .pill{
    display:inline-block;
    background:#004d40;
    color:#fff;
    padding:6px 10px;
    border-radius:999px;
    font-size:.85rem;
    margin-bottom: 10px;
  }
  .card h3{
    margin:0 0 8px;
    color:#004d40;
    font-size:1.25rem;
    font-weight:800;
  }
  .text{
    line-height:1.8;
    color:#37474f;
    font-size: .98rem;
  }

  /* CTA FINAL */
  .cta{
    display:flex;
    gap:14px;
    align-items:center;
    flex-wrap:wrap;
    justify-content:space-between;
  }
  .btn{
    display:inline-block;
    text-decoration:none;
    padding:10px 16px;
    border-radius:10px;
    font-weight:700;
  }
  .btn-primary{ background:#00796B; color:#fff; }
  .btn-soft{ background:#e0f2f1; color:#00695c; }

  @media (max-width:980px){
    .twocol{ grid-template-columns:1fr; }
    .slides img{ height: 44vh; }
    .below-banner img{ height: 220px; }
  }
  @media (max-width:640px){
    .slides img{ height: 32vh; }
    .below-banner img{ height: 180px; }
  }
</style>
{% endblock %}

{% block content %}

<!-- HERO + SLIDER -->
<section class="hero">
  <div class="wrap">

    <h2 class="h2">
      {% if page and page.title %}{{ page.title }}{% else %}Conócenos{% endif %}
    </h2>

    <p class="lead">
      {% if page and page.subtitle %}{{ page.subtitle }}{% else %}
        Quiénes somos, nuestro propósito y el equipo que acompaña a nuestras familias.
      {% endif %}
    </p>

    <div class="slider" id="gg-slider" aria-roledescription="carousel">
      <div class="slides" id="gg-slides">
        {% if slides %}
          {% for s in slides %}
            <div class="slide">
              <img src="{{ s.image.url }}" alt="{{ s.title|default:'Slide Nosotros' }}">
            </div>
          {% endfor %}
        {% else %}
          <div class="slide">
            <img src="{% static 'sitio/img/fachada.PNG' %}" alt="Nosotros">
          </div>
        {% endif %}
      </div>
      <div class="dots" id="gg-dots" aria-label="Selector de imagen"></div>
    </div>

    {% if page and page.banner %}
      <div class="below-banner">
        <img src="{{ page.banner.url }}" alt="Banner Nosotros">
      </div>
    {% endif %}

  </div>
</section>

<!-- CONTENIDO DEBAJO (Misión + Visión en 2 columnas) -->
<section class="section">
  <div class="wrap">

    <div class="twocol">
      <!-- MISIÓN -->
      <div class="card">
        <span class="pill">Nuestra misión</span>
        <h3>
          {% if mision and mision.title %}{{ mision.title }}{% else %}Misión{% endif %}
        </h3>
        <div class="text">
          {% if mision and mision.content %}
            {{ mision.content|linebreaksbr }}
          {% else %}
            Crea una Página pública con slug <b>mision</b>.
          {% endif %}
        </div>
      </div>

      <!-- VISIÓN -->
      <div class="card">
        <span class="pill" style="background:#00695c;">Nuestra visión</span>
        <h3>
          {% if vision and vision.title %}{{ vision.title }}{% else %}Visión{% endif %}
        </h3>
        <div class="text">
          {% if vision and vision.content %}
            {{ vision.content|linebreaksbr }}
          {% else %}
            Crea una Página pública con slug <b>vision</b>.
          {% endif %}
        </div>
      </div>
    </div>

  </div>
</section>

<!-- HISTORIA (ancho completo) -->
<section class="section">
  <div class="wrap">
    <div class="card">
      <span class="pill" style="background:#00897b;">Nuestra historia</span>
      <h3>
        {% if historia and historia.title %}{{ historia.title }}{% else %}Historia{% endif %}
      </h3>
      <div class="text">
        {% if historia and historia.content %}
          {{ historia.content|linebreaksbr }}
        {% else %}
          Crea una Página pública con slug <b>historia</b>.
        {% endif %}
      </div>
    </div>
  </div>
</section>

<!-- CTA FINAL -->
<section class="section" style="padding-bottom:34px;">
  <div class="wrap card cta">
    <div>
      <h3 style="margin:0 0 6px;color:#004d40;">¿Quieres conocernos mejor?</h3>
      <p style="margin:0; color:#546e7a;">Visítanos o escríbenos. ¡Será un gusto recibirte!</p>
    </div>
    <div>
      <a href="{% url 'sitio:admisiones' %}" class="btn btn-primary">Proceso de Admisiones</a>
      <a href="{% url 'sitio:contacto' %}" class="btn btn-soft">Contacto</a>
    </div>
  </div>
</section>

{% endblock %}

{% block extra_js %}
<script>
(function() {
  const slides = document.getElementById('gg-slides');
  const dotsWrap = document.getElementById('gg-dots');
  if (!slides || !dotsWrap) return;

  const total = slides.children.length;
  let idx = 0, t;

  // dots
  dotsWrap.innerHTML = "";
  for (let i = 0; i < total; i++) {
    const b = document.createElement('button');
    b.className = 'dot' + (i === 0 ? ' active' : '');
    b.setAttribute('aria-label', 'Ir a imagen ' + (i + 1));
    b.addEventListener('click', () => go(i, true));
    dotsWrap.appendChild(b);
  }
  const dots = dotsWrap.querySelectorAll('.dot');

  function go(n, pause) {
    idx = (n + total) % total;
    slides.style.transform = `translateX(${-idx * 100}%)`;
    dots.forEach((d, i) => d.classList.toggle('active', i === idx));
    if (pause) reset();
  }

  function next(){ go(idx + 1); }
  function reset(){
    clearInterval(t);
    t = setInterval(next, 5000);
  }

  reset();
})();
</script>
{% endblock %}