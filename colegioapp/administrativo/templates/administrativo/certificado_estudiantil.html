{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Certificado estudiantil</title>

  <style>
    @page { size: A4; margin: 8mm; }

    html, body { height: 100%; margin: 0; padding: 0; }
    body { font-family: sans-serif; font-size: 12px; }

    .contenedor{
      box-sizing: border-box;
      width: 100%;
      height: 100%;
      border: 4px double #000;
      padding: 12mm 15mm 12mm;
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .watermark{
      position: absolute;
      top: 55%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80%;
      opacity: 0.06;
      z-index: 0;
    }

    .encabezado, .cuerpo, .footer-block { position: relative; z-index: 1; }

    .encabezado{
      display: flex;
      align-items: flex-start;
      justify-content: center;
      gap: 20px;
      margin-bottom: 8px;
    }

    .logo{ width: 120px; height: auto; }
    .titulo{ text-align: center; flex: 1; }

    .titulo-principal{ font-weight: 800; font-size: 18px; letter-spacing: 1px; margin-bottom: 4px; }
    .titulo-sub{ font-weight: 700; font-size: 12px; margin-bottom: 8px; }
    .titulo-detalle{ font-weight: normal; font-size: 10px; margin: 2px 0; line-height: 1.2; }

    .cuerpo{ margin-top: 45mm; }
    .titulo-cert{ text-align: center; font-weight: bold; margin-bottom: 26px; }

    .texto{ text-align: justify; margin: 0 0 26px; line-height: 1.6; }

    .detalles-cert{ margin: 22px 0 30px; text-align: left; }
    .detalles-cert p{ margin: 0 0 6px; line-height: 1.5; }
    .detalles-cert strong{ font-weight: bold; }

    .footer-block{
      position: absolute;
      left: 15mm;
      right: 15mm;
      bottom: 12mm;
      text-align: center;
    }

    .firma{ margin-bottom: 6px; }
    .pie{ font-size: 10px; }

    .header-top{
      font-size: 10px;
      color: #333;
      width: 100%;
      display: flex;
      justify-content: space-between;
      padding: 0 5mm;
      margin-bottom: 4px;
      position: relative;
      top: -4mm;
    }
    .contenedor{ position: relative; }  /* importante, ya lo tienes */

    .sello-firma{
      position: absolute;
      right: 15mm;   /* pegado a la derecha del marco */
      bottom: 12mm;  /* alineado con el padding inferior */
      width: 35mm;   /* ajusta tamaño */
      height: auto;
      z-index: 3;
    }
  </style>
</head>

<body>

  <div class="header-top">
    <span class="fecha">{{ hoy|date:"d/m/Y" }}</span>
    <span>
      {% if school %}{{ school.name }}{% else %}Centro Educativo{% endif %}
    </span>
  </div>

  <div class="contenedor">

    {# ✅ Marca de agua = SELLO. Si está vacío: NO se muestra nada #}
    {% if watermark_url %}
      <img src="{{ watermark_url }}" alt="Marca de agua" class="watermark">
    {% endif %}

    <div class="encabezado">
      {# ✅ Logo del colegio. Si no existe, fallback al estático #}
      {% if logo_url %}
        <img src="{{ logo_url }}" alt="Logo" class="logo">
      {% else %}
        <img src="{% static 'img/logo.png' %}" alt="Logo" class="logo">
      {% endif %}

      <div class="titulo">
        <div class="titulo-principal">
          {% if school %}{{ school.name|upper }}{% else %}CENTRO EDUCATIVO{% endif %}
        </div>

        {% if school and school.slogan %}
          <div class="titulo-sub">{{ school.slogan|upper }}</div>
        {% endif %}
      </div>
    </div>

    <div class="cuerpo">
      <p class="titulo-cert">CERTIFICAN QUE:</p>

      <p class="texto">
        {{ estudiante.nombres }} {{ estudiante.apellidos }}, con identificación No.
        {% if tipo_id %}{{ tipo_id }} {% endif %}{{ estudiante.identificacion }}
        se encuentra matriculado en esta institución educativa
        en el grado {{ grado_texto }} en un horario de 7:00 a.m. a 2:00 p.m.
      </p>

      <div class="detalles-cert">
        <p><strong>Calendario A</strong></p>
        <p><strong>Jornada Única:</strong> lunes a viernes</p>
        <p><strong>Durante Año Escolar:</strong> (10 meses)</p>
        <p><strong>Intensidad Horaria:</strong> (32h/s)</p>
      </div>

      <p class="texto">
        La presente se expide a solicitud del interesado,
        a los {{ hoy.day }} días del mes de {{ hoy|date:"F" }} del año {{ hoy|date:"Y" }}.
      </p>
    </div>

    <div class="footer-block">
      {# ✅ SELLO en el recuadro derecho (si no hay, no aparece) #}
      {% if sello_url %}
        <img src="{{ sello_url }}" alt="Sello" class="sello-firma">
      {% endif %}
      <div class="firma">
        <div>{% if rector_nombre %}{{ rector_nombre }}{% else %}________________{% endif %}</div>
        <div>_______________________________</div>
        <div>{% if rector_cargo %}{{ rector_cargo }}{% else %}RECTOR(A){% endif %}</div>
      </div>

      <div class="pie">
        {% if school and school.address %}{{ school.address }}{% endif %}
        {% if school and school.address and school.phone %} | {% endif %}
        {% if school and school.phone %}Tel: {{ school.phone }}{% endif %}
      </div>
    </div>

  </div>
</body>
</html>