{% extends "colegioapp/base.html" %}
{% load static %}

{% block title %}Contratos | Centro Educativo Infantil GIN GABY{% endblock %}

{% block content %}
<main>
  <h2>Contratos</h2>

  <!-- Filtros -->
  <form method="get" style="max-width:1000px;margin:0 auto 18px;display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
    <input
      type="text" name="q" value="{{ q }}"
      placeholder="Buscar por empleado o identificaci√≥n"
      style="flex:1; padding:10px 12px; border:1px solid #cfd8dc; border-radius:8px;"
    />
    <input
      type="text" name="tipo" value="{{ tipo }}"
      placeholder="Tipo de contrato (ej. Fijo, Indefinido)"
      style="padding:10px 12px; border:1px solid #cfd8dc; border-radius:8px;"
    />
    <select name="estado" style="padding:10px 12px; border:1px solid #cfd8dc; border-radius:8px;">
      <option value="">Todos</option>
      <option value="vigente" {% if estado == 'vigente' %}selected{% endif %}>Vigentes</option>
      <option value="vencido" {% if estado == 'vencido' %}selected{% endif %}>Vencidos</option>
    </select>

    <button type="submit" style="padding:10px 16px; background:#00796B; color:white; border:none; border-radius:8px; cursor:pointer;">
      Filtrar
    </button>
    <a href="{% url 'administrativo:contratos' %}" style="padding:10px 16px; background:#90a4ae; color:white; border-radius:8px; text-decoration:none;">
      Limpiar
    </a>
    <a href="{% url 'administrativo:contrato_create' %}"
       style="display:inline-block;background:#00796B;color:#fff;
              padding:10px 14px;border-radius:8px;text-decoration:none;">
       + Nuevo contrato
    </a>
  </form>

  <!-- Tabla -->
  <div style="max-width:1000px;margin:0 auto;">
    <div style="overflow-x:auto; background:white; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.06);">
      <table style="width:100%; border-collapse:collapse;">
        <thead style="background:#e0f2f1;">
          <tr>
            <th style="text-align:left; padding:12px;">Empleado</th>
            <th style="text-align:left; padding:12px;">Tipo</th>
            <th style="text-align:left; padding:12px;">Inicio</th>
            <th style="text-align:left; padding:12px;">Fin</th>
            <th style="text-align:right; padding:12px;">Valor</th>
            <th style="text-align:center; padding:12px;">Estado</th>
            <th style="text-align:center; padding:12px;">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% if page_obj.object_list %}
            {% for c in page_obj.object_list %}
            <tr style="border-top:1px solid #eceff1;">
              <td style="padding:10px 12px;">
                {{ c.empleado.apellidos }} {{ c.empleado.nombres }} ({{ c.empleado.identificacion }})
              </td>
              <td style="padding:10px 12px;">{{ c.tipo_contrato }}</td>
              <td style="padding:10px 12px;">{{ c.fecha_inicio|date:"Y-m-d" }}</td>
              <td style="padding:10px 12px;">{{ c.fecha_fin|date:"Y-m-d"|default:"‚Äî" }}</td>
              <td style="padding:10px 12px; text-align:right;">${{ c.valor|floatformat:0 }}</td>
              <td style="padding:10px 12px; text-align:center;">
                {% if not c.fecha_fin or c.fecha_fin >= today %}
                  <span style="background:#e8f5e9;color:#2e7d32;padding:4px 8px;border-radius:12px;">Vigente</span>
                {% else %}
                  <span style="background:#ffebee;color:#c62828;padding:4px 8px;border-radius:12px;">Vencido</span>
                {% endif %}
              </td>
              <td style="padding:10px 12px; text-align:center; white-space:nowrap;">
                <a href="{% url 'administrativo:contrato_update' c.id %}" style="text-decoration:none; margin-right:8px;">‚úèÔ∏è Editar</a>
                <a href="{% url 'administrativo:contrato_delete' c.id %}" style="text-decoration:none; color:#c62828;">üóë Eliminar</a>
              </td>
            </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="6" style="padding:14px; text-align:center; color:#607d8b;">No se encontraron contratos.</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>

    <!-- Paginaci√≥n -->
    {% if page_obj.paginator.num_pages > 1 %}
    <div style="display:flex; justify-content:center; gap:6px; margin:18px 0;">
      {% if page_obj.has_previous %}
        <a href="?page=1{% if q %}&q={{ q }}{% endif %}{% if tipo %}&tipo={{ tipo }}{% endif %}{% if estado %}&estado={{ estado }}{% endif %}" style="padding:8px 10px; border:1px solid #cfd8dc; border-radius:8px; text-decoration:none;">¬´ Primero</a>
        <a href="?page={{ page_obj.previous_page_number }}{% if q %}&q={{ q }}{% endif %}{% if tipo %}&tipo={{ tipo }}{% endif %}{% if estado %}&estado={{ estado }}{% endif %}" style="padding:8px 10px; border:1px solid #cfd8dc; border-radius:8px; text-decoration:none;">‚Äπ Anterior</a>
      {% endif %}

      <span style="padding:8px 10px; border:1px solid #cfd8dc; border-radius:8px; background:#f5f5f5;">
        P√°gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
      </span>

      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{% if q %}&q={{ q }}{% endif %}{% if tipo %}&tipo={{ tipo }}{% endif %}{% if estado %}&estado={{ estado }}{% endif %}" style="padding:8px 10px; border:1px solid #cfd8dc; border-radius:8px; text-decoration:none;">Siguiente ‚Ä∫</a>
        <a href="?page={{ page_obj.paginator.num_pages }}{% if q %}&q={{ q }}{% endif %}{% if tipo %}&tipo={{ tipo }}{% endif %}{% if estado %}&estado={{ estado }}{% endif %}" style="padding:8px 10px; border:1px solid #cfd8dc; border-radius:8px; text-decoration:none;">√öltima ¬ª</a>
      {% endif %}
    </div>
    {% endif %}

    <!-- Bot√≥n volver -->
    <div style="text-align:center; margin-top:20px;">
      <a href="{% url 'administrativo:home' %}" style="padding:10px 18px; background:#004d40; color:white; text-decoration:none; border-radius:8px;">‚¨Ö Volver al m√≥dulo administrativo</a>
    </div>
  </div>
</main>
{% endblock content %}